<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
   
    <script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
    <script>
        function getUserIP(onNewIP){
  const myPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
  const pc = new myPeerConnection({ iceServers: [] });
  const noop = function() {};
  const localIPs = {};
  const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g;
  const key = null;
 
  function iterateIP(ip) {
    if (!localIPs[ip]) onNewIP(ip);
    localIPs[ip] = true;
  }
 
  pc.createDataChannel("");
 
  pc.createOffer().then((sdp)=> {
    sdp.sdp.split('\n').forEach((line)=> {
      if (line.indexOf('candidate') < 0) return;
      line.match(ipRegex).forEach(iterateIP);
    });
    pc.setLocalDescription(sdp, noop, noop);
  }).catch((reason)=>{ });
 
  pc.onicecandidate = function(ice) {
    if (!ice || !ice.candidate || !ice.candidate.candidate || !ice.candidate.candidate.match(ipRegex)) return;
    ice.candidate.candidate.match(ipRegex).forEach(iterateIP);
  };
}
 

function showIp(ip)=>{
  console.log("当前机子的ip=",ip);
}
        getUserIP((ip)=>{
  showIp(ip);
});
 
        </script>
     <div>returnCitySN.cip</div>
</body>
</html>
